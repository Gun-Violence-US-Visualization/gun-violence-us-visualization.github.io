{"ast":null,"code":"var _jsxFileName = \"/Users/lion/Sites/Visualization/project-on-github/Gun_Violence_US_Visualization/src/charts/Data_sum.js\",\n    _s = $RefreshSig$();\n\nimport React, { useState, useEffect, useCallback } from \"react\";\nimport * as d3 from \"d3\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\n\nfunction Data_sum(props) {\n  _s();\n\n  const [statesData, setStatesData] = useState([]); //react用来注释数据\n\n  const ref = React.useRef(null); // const [selectedVar, setSelectedVar] = useState(\"Case Number\")\n  // const [var2, setVar2] = useState(\"Killed\")\n  // const [var3, setVar3] = useState(\"Injured\")\n  // console.log(data)\n\n  const [size, setSize] = useState({\n    width: document.documentElement.clientWidth,\n    hieght: document.documentElement.clientHeight\n  });\n  const onResize = useCallback(() => {\n    setSize({\n      width: document.documentElement.clientWidth,\n      height: document.documentElement.clientHeight\n    });\n  }, []);\n  useEffect(() => {\n    (async () => {\n      window.addEventListener('resize', onResize); // set the dimensions and margins of the graph\n\n      const margin = {\n        top: 100,\n        right: 0,\n        bottom: 0,\n        left: 0\n      },\n            width = ref.current.clientWidth - 30,\n            height = width * 1.4 - margin.top - margin.bottom,\n            innerRadius = 150,\n            outerRadius = Math.min(width, height) / 2; // the outerRadius goes from the middle of the SVG area to the border\n\n      const svgEL = d3.select(ref.current);\n      svgEL.selectAll(\"*\").remove(); // append the svg object to the body of the page\n\n      const svg = svgEL.append(\"svg\").attr(\"width\", width + margin.left + margin.right).attr(\"height\", height + margin.top + margin.bottom).append(\"g\").attr(\"transform\", `translate(${width / 2 + margin.left}, ${height / 2 + margin.top})`);\n      d3.csv(\"./data/state_sum.csv\").then(function (data) {\n        // X scale: common for 2 data series\n        const x = d3.scaleBand().range([0, 2 * Math.PI]) // X axis goes from 0 to 2pi = all around the circle. If I stop at 1Pi, it will be around a half circle\n        .align(0) // This does nothing\n        .domain(data.map(d => d.state)); // The domain of the X axis is the list of states.\n        // Y scale outer variable\n\n        const y = d3.scaleRadial().range([innerRadius, outerRadius]) // Domain will be define later.\n        .domain([0, 2000]); // Domain of Y is from 0 to the max seen in the data\n        // Second barplot Scales\n\n        const ybis = d3.scaleRadial().range([innerRadius, 5]) // Domain will be defined later.\n        .domain([0, 2000]); // Add the bars\n\n        svg.append(\"g\").selectAll(\"path\").data(data).join(\"path\").attr(\"fill\", \"#a52723\").attr(\"class\", \"yo\").attr(\"d\", d3.arc() // imagine your doing a part of a donut plot\n        .innerRadius(innerRadius).outerRadius(d => y(d.KI)).startAngle(d => x(d.state)).endAngle(d => x(d.state) + x.bandwidth()).padAngle(0.01).padRadius(innerRadius)); // Add the labels\n\n        svg.append(\"g\").selectAll(\"g\").data(data).join(\"g\").attr(\"text-anchor\", function (d) {\n          return (x(d.state) + x.bandwidth() / 2 + Math.PI) % (2 * Math.PI) < Math.PI ? \"end\" : \"start\";\n        }).attr(\"transform\", function (d) {\n          return \"rotate(\" + ((x(d.state) + x.bandwidth() / 2) * 180 / Math.PI - 90) + \")\" + \"translate(\" + (y(d.KI) + 10) + \",0)\";\n        }).append(\"text\").text(d => d.state).attr(\"transform\", function (d) {\n          return (x(d.state) + x.bandwidth() / 2 + Math.PI) % (2 * Math.PI) < Math.PI ? \"rotate(180)\" : \"rotate(0)\";\n        }).style(\"font-size\", \"11px\").attr(\"alignment-baseline\", \"middle\"); // Add the second series\n\n        svg.append(\"g\").selectAll(\"path\").data(data).join(\"path\").attr(\"fill\", \"grey\").attr(\"d\", d3.arc() // imagine your doing a part of a donut plot\n        .innerRadius(d => ybis(0)).outerRadius(d => ybis(d.KI)).startAngle(d => x(d.state)).endAngle(d => x(d.state) + x.bandwidth()).padAngle(0.01).padRadius(innerRadius));\n      });\n      return () => {\n        window.removeEventListener('resize', onResize);\n      };\n    })();\n  }, [statesData.length, size.width]);\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"down-chart-container\",\n    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"chart-title\",\n      children: \"SUM of GUN HOLD POLICY in each STATE\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 113,\n      columnNumber: 13\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      viewBox: \"0 0 960 600\",\n      className: \"usData_sum\",\n      ref: ref\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 114,\n      columnNumber: 13\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 112,\n    columnNumber: 9\n  }, this);\n}\n\n_s(Data_sum, \"Xf3OFVLaA7FZ8GWdS1ChSE1uZUE=\");\n\n_c = Data_sum;\nexport default Data_sum;\n\nvar _c;\n\n$RefreshReg$(_c, \"Data_sum\");","map":{"version":3,"sources":["/Users/lion/Sites/Visualization/project-on-github/Gun_Violence_US_Visualization/src/charts/Data_sum.js"],"names":["React","useState","useEffect","useCallback","d3","Data_sum","props","statesData","setStatesData","ref","useRef","size","setSize","width","document","documentElement","clientWidth","hieght","clientHeight","onResize","height","window","addEventListener","margin","top","right","bottom","left","current","innerRadius","outerRadius","Math","min","svgEL","select","selectAll","remove","svg","append","attr","csv","then","data","x","scaleBand","range","PI","align","domain","map","d","state","y","scaleRadial","ybis","join","arc","KI","startAngle","endAngle","bandwidth","padAngle","padRadius","text","style","removeEventListener","length"],"mappings":"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","sourcesContent":["import React, { useState, useEffect, useCallback } from \"react\"\r\nimport * as d3 from \"d3\"\r\n\r\nfunction Data_sum(props) {\r\n    const [statesData, setStatesData] = useState([]);     //react用来注释数据\r\n    const ref = React.useRef(null)\r\n    // const [selectedVar, setSelectedVar] = useState(\"Case Number\")\r\n    // const [var2, setVar2] = useState(\"Killed\")\r\n    // const [var3, setVar3] = useState(\"Injured\")\r\n    // console.log(data)\r\n    const [size, setSize] = useState({\r\n        width: document.documentElement.clientWidth,\r\n        hieght: document.documentElement.clientHeight\r\n    })\r\n\r\n    const onResize = useCallback(() => {\r\n        setSize({\r\n            width: document.documentElement.clientWidth,\r\n            height: document.documentElement.clientHeight,\r\n        })\r\n    }, [])\r\n\r\n    useEffect(() => {\r\n        (async () => {\r\n            window.addEventListener('resize', onResize);\r\n            // set the dimensions and margins of the graph\r\n            const margin = { top: 100, right: 0, bottom: 0, left: 0 },\r\n                width = ref.current.clientWidth - 30,\r\n                height = width * 1.4 - margin.top - margin.bottom,\r\n                innerRadius = 150,\r\n                outerRadius = Math.min(width, height) / 2;   // the outerRadius goes from the middle of the SVG area to the border\r\n\r\n            const svgEL = d3.select(ref.current);\r\n            svgEL.selectAll(\"*\").remove();\r\n\r\n            // append the svg object to the body of the page\r\n            const svg = svgEL\r\n                .append(\"svg\")\r\n                .attr(\"width\", width + margin.left + margin.right)\r\n                .attr(\"height\", height + margin.top + margin.bottom)\r\n                .append(\"g\")\r\n                .attr(\"transform\", `translate(${width / 2 + margin.left}, ${height / 2 + margin.top})`);\r\n\r\n            d3.csv(\"./data/state_sum.csv\").then(function (data) {\r\n\r\n                // X scale: common for 2 data series\r\n                const x = d3.scaleBand()\r\n                    .range([0, 2 * Math.PI])    // X axis goes from 0 to 2pi = all around the circle. If I stop at 1Pi, it will be around a half circle\r\n                    .align(0)                  // This does nothing\r\n                    .domain(data.map(d => d.state)); // The domain of the X axis is the list of states.\r\n\r\n                // Y scale outer variable\r\n                const y = d3.scaleRadial()\r\n                    .range([innerRadius, outerRadius])   // Domain will be define later.\r\n                    .domain([0, 2000]); // Domain of Y is from 0 to the max seen in the data\r\n\r\n                // Second barplot Scales\r\n                const ybis = d3.scaleRadial()\r\n                    .range([innerRadius, 5])   // Domain will be defined later.\r\n                    .domain([0, 2000]);\r\n\r\n                // Add the bars\r\n                svg.append(\"g\")\r\n                    .selectAll(\"path\")\r\n                    .data(data)\r\n                    .join(\"path\")\r\n                    .attr(\"fill\", \"#a52723\")\r\n                    .attr(\"class\", \"yo\")\r\n                    .attr(\"d\", d3.arc()     // imagine your doing a part of a donut plot\r\n                        .innerRadius(innerRadius)\r\n                        .outerRadius(d => y(d.KI))\r\n                        .startAngle(d => x(d.state))\r\n                        .endAngle(d => x(d.state) + x.bandwidth())\r\n                        .padAngle(0.01)\r\n                        .padRadius(innerRadius))\r\n\r\n                // Add the labels\r\n                svg.append(\"g\")\r\n                    .selectAll(\"g\")\r\n                    .data(data)\r\n                    .join(\"g\")\r\n                    .attr(\"text-anchor\", function (d) { return (x(d.state) + x.bandwidth() / 2 + Math.PI) % (2 * Math.PI) < Math.PI ? \"end\" : \"start\"; })\r\n                    .attr(\"transform\", function (d) { return \"rotate(\" + ((x(d.state) + x.bandwidth() / 2) * 180 / Math.PI - 90) + \")\" + \"translate(\" + (y(d.KI) + 10) + \",0)\"; })\r\n                    .append(\"text\")\r\n                    .text(d => d.state)\r\n                    .attr(\"transform\", function (d) { return (x(d.state) + x.bandwidth() / 2 + Math.PI) % (2 * Math.PI) < Math.PI ? \"rotate(180)\" : \"rotate(0)\"; })\r\n                    .style(\"font-size\", \"11px\")\r\n                    .attr(\"alignment-baseline\", \"middle\")\r\n\r\n                // Add the second series\r\n                svg.append(\"g\")\r\n                    .selectAll(\"path\")\r\n                    .data(data)\r\n                    .join(\"path\")\r\n                    .attr(\"fill\", \"grey\")\r\n                    .attr(\"d\", d3.arc()     // imagine your doing a part of a donut plot\r\n                        .innerRadius(d => ybis(0))\r\n                        .outerRadius(d => ybis(d.KI))\r\n                        .startAngle(d => x(d.state))\r\n                        .endAngle(d => x(d.state) + x.bandwidth())\r\n                        .padAngle(0.01)\r\n                        .padRadius(innerRadius))\r\n\r\n            });\r\n            return (() => {\r\n                window.removeEventListener('resize', onResize)\r\n            })\r\n        })();\r\n    }, [statesData.length, size.width]\r\n    )\r\n    return (\r\n        <div className=\"down-chart-container\">\r\n            <div className=\"chart-title\">SUM of GUN HOLD POLICY in each STATE</div>\r\n            <div viewBox=\"0 0 960 600\" className=\"usData_sum\" ref={ref}></div>\r\n            {/* <div className=\"down-chart-example\"><img src=\"./profile.svg\" height=\"150px\"/> </div> */}\r\n        </div>\r\n    )\r\n}\r\n\r\nexport default Data_sum"]},"metadata":{},"sourceType":"module"}